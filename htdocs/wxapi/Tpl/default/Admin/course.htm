
<include file = "Common:admin_header" />

<script src="/wxapi/public/js/jquery-1.12.4.js" language="javascript"></script>
<script src="/wxapi/public/js/jquery-ui.js" language="javascript"></script>
<script src="/wxapi/public/js/assil-rangebar.js" language="javascript"></script>
<script src="/wxapi/public/js/jquery.jedate.js" language="javascript"></script>

<link href="/wxapi/public/css/assil-rangebar.css" type="text/css" rel="stylesheet"/>
<link href="/wxapi/public/css/jquery-ui.css" type="text/css" rel="stylesheet"/>
<link href="/wxapi/public/css/jedate.css" type="text/css" rel="stylesheet">

<style>
.custom-range-green {
  background-color: lightseagreen;
}
.ui-slider-horizontal {
  height: 25px;
}
.ui-slider-pips .ui-slider-pip {
  top: 26px;
}
.slider .ui-slider-tip {
  margin-left: -35px;
  font-weight: bold;
  width: 70px;
  opacity: 1;
  top: -30px;
}
.ui-resizable {
  position: absolute;
}
.task-pane {
  width: 80%;
  margin-top: 10px;
  background-color: #F7F7F7;
  padding: 30px 30px 20px 20px;
}
.task-item {
  height: 55px;
}
.week-name {
  float: left;
  width: 55px;
  height: 32px;
  line-height: 32px;
  color: #333;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.slider {
  margin-left: 55px;
}
.datainp {
  border:1px #A5D2EC solid;
}
.wicon{
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAQCAYAAADj5tSrAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABZ0RVh0Q3JlYXRpb24gVGltZQAwNi8xNS8xNGnF/oAAAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzVxteM2AAAAoElEQVQ4jWPceOnNfwYqAz9dYRQ+E7UtwAaGjyUsDAyYYUgJ2HT5LXZLcEmSCnA6duOlN///////H0bDALl8dPH/////Z8FuNW6Qtvw2nL3lyjsGBgYGhlmRqnj1kGwJuqHIlhJlCXq8EOITEsdqCXLEbbr8FisfFkTo+vBZRFZwERNEFFkCiw90nxJtCalxQmzegltCzVyP1RJq5HZ8AABuNZr0628DMwAAAABJRU5ErkJggg==");
  background-repeat: no-repeat;
  background-position: right center;
}
</style>

<!-- 中心数据区 -->
<div class="layui-tab layui-tab-brief">
  <div class="layui-body layui-tab-content site-demo">
    <div class="layui-tab-item layui-show">
      <div class="layui-main">
        <fieldset class="layui-elem-field layui-field-title">
          <legend>
            <eq name='my_nav_type' value='camera'>
            <i class="fa fa-cloud-upload">&nbsp;&nbsp;</i>采集端管理 - 
            <i class="fa fa-video-camera">&nbsp;</i>摄像头 - 
            <else/>
            <i class="fa fa-video-camera">&nbsp;</i>直播管理 - 
            </eq>
            <i class="fa fa-file-video-o">&nbsp;</i>录像计划表
            <eq name='my_web_type' value='0'>
            <i class="fa fa-list-alt">&nbsp;</i> - {{$my_grade.grade_type}}&nbsp;{{$my_grade.grade_name}}&nbsp;{{$my_grade.camera_name}}
            </eq>
          </legend>
        </fieldset>
        <span class="layui-breadcrumb">
          <eq name='my_nav_type' value='camera'>
          <a href="{{:__APP__}}/Admin/gather">采集端</a>
          <a href="{{:__APP__}}/Admin/camera/gather_id/{{$my_gather_id}}">摄像头</a>
          <else/>
          <a href="{{:__APP__}}/Admin/live">直播列表</a>
          </eq>
          <a><cite>录像计划表</cite></a>
        </span>
        <div class="task-pane">
          <div class="task-item">
            <div class="week-name">星期日</div>
            <div class="slider" id="s_0"></div>
          </div>
          <div class="task-item">
            <div class="week-name">星期一</div>
            <div class="slider" id="s_1"></div>
          </div>
          <div class="task-item">
            <div class="week-name">星期二</div>
            <div class="slider" id="s_2"></div>
          </div>
          <div class="task-item">
            <div class="week-name">星期三</div>
            <div class="slider" id="s_3"></div>
          </div>
          <div class="task-item">
            <div class="week-name">星期四</div>
            <div class="slider" id="s_4"></div>
          </div>
          <div class="task-item">
            <div class="week-name">星期五</div>
            <div class="slider" id="s_5"></div>
          </div>
          <div class="task-item">
            <div class="week-name">星期六</div>
            <div class="slider" id="s_6"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// 获取网站地址...
var siteurl="{{:__APP__}}";
// 定义星期数组...
var weekday = new Array("周日", "周一", "周二", "周三", "周四", "周五", "周六");
// 定义小时数组...
var arrHours = ["0",  "1",  "2",  "3",  "4",  "5",  "6",  "7",  "8",  "9",  "10",  "11", "12",
                 "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24"];
// 处理双击区间框事件...
var onDbClickEvent = function($range, strStart, strEnd) {
  // 弹出等待框，兼容IE8...
  var index = layer.load(2);
  $.ajaxSetup({ cache:false });
  // specail for 24:00:00 time...
  strStart = ((strStart == "24:00:00") ? "23:59:59" : strStart);
  strEnd = ((strEnd == "24:00:00") ? "23:59:59" : strEnd);
  // 获取弹框页面内容...
  $.ajax({
    type: "get",
    async: true,
    url: siteurl+"/Admin/getClock/",
    success: function(ajaxData) {
      layer.closeAll('loading');
      // open the layui dialog...
      layer.open({
        type: 1, //0(dialog), 1(page), 2(iframe), 3(loading), 4(tips)
        closeBtn: 1,
        fixed: true,
        shadeClose: false,
        area: ['350px', '240px'],
        title: "<i class='fa fa-clock-o'>&nbsp;&nbsp;</i>编辑 - 录像时间",
        content: ajaxData,
        success: function() {
          var form = layui.form();
          var arrStart = strStart.split(':');
          var arrEnd = strEnd.split(':');
          var objStart = $("input[name='myStart']");
          var objEnd = $("input[name='myEnd']");
          objStart.val(strStart);
          objEnd.val(strEnd);
          objStart.jeDate({
            isinitVal: true,
            hmsSetVal: {hh:arrStart[0],mm:arrStart[1],ss:arrStart[2]},
            minDate: '2016-06-16',
            maxDate: '2025-06-16',
            format: "hh:mm:ss",
            zIndex: 119891016,
          });
          objEnd.jeDate({
            isinitVal: true,
            hmsSetVal: {hh:arrEnd[0],mm:arrEnd[1],ss:arrEnd[2]},
            minDate: '2016-06-16',
            maxDate: '2025-06-16',
            format: "hh:mm:ss",
            zIndex: 119891016,
          });
          form.on('submit(formRange)', function(data) {
            // 获取修改后的时间数据...
            var strNewStart = data.field.myStart;
            var strNewEnd = data.field.myEnd;
            var nNewStart = $.timeStampDate("2017-07-18 "+strNewStart, false);
            var nNewEnd = $.timeStampDate("2017-07-18 "+strNewEnd, false);
            if((nNewEnd <= nNewStart) || ((nNewEnd - nNewStart) <= 30)) {
              layer.msg('【结束时间】必须大于【开始时间】！<br>并且，时间差必须大于30秒！', {icon: 2});
              return false;
            }
            // 用新的时间数据应用到范围选择框中...
            strNewStart = ((strNewStart == "23:59:59") ? "24:00:00" : strNewStart);
            strNewEnd = ((strNewEnd == "23:59:59") ? "24:00:00" : strNewEnd);
            if( !$range.parent().rangebar('applyRange', $range, strNewStart, strNewEnd) ) {
              layer.msg('时间段发生重叠，应用失败！', {icon: 2});
              return false;
            }
            // 关闭对话框，直接返回...
            layer.closeAll('page');
            // 避免form自动跳转...
            return false;
          });
          // 点击取消操作...
          $('.js_form_close').unbind("click").click( function() {
            layer.closeAll('page');
          });
        }
      });
    },
    error: function(e) {
      layer.closeAll('loading');
      layer.alert(e, {icon: 2});
    }
  });
};
// 处理range被创建的事件...
var onRenderRange = function($range, range) {
};
// 处理range位置被更新的事件...
var onUpdateRange = function($range, range) {
};
// 处理range被聚焦的事件...
var onFocusEvent = function($range, range) {
};
// 处理range被删除的事件...
var onDeleteEvent = function($range, range) {
};
// 页面加载完毕之后的操作...
$(document).ready(function() {
  // 创建滑动条...
  $(".slider").rangebar({
    min: 0,
    max: 86400,
    ranges:[ { start: 0, end: 86400 } ],
    renderRange: onRenderRange,
    updateRange: onUpdateRange,
    focusEvent:  onFocusEvent,
    deleteEvent: onDeleteEvent,
    dbClickEvent: onDbClickEvent
  }).rangebar("pips", {
    step: 3600,
    rest: "label",
    labels: arrHours
  }).rangebar("float", {
    time: true,
  });
});
// 处理 layui 过程...
layui.use(['element','layer','form','laydate'], function(){
  var theCameraID = {{$my_camera_id}};
  var theGatherID = {{$my_gather_id}};
  var element = layui.element();
  var $ = layui.jquery;
});

</script>

<include file = "Common:admin_footer" />
