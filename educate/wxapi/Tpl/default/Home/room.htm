
<include file = "Common:home_header" />
<include file = "Common:home_nav" />

<section class="content-wrap">
  <div class="container">
    <div class="row">
      <main class="col-md-12">
        <article class="post">
          <h4 class="title">
            <span class="tline">直播教室（{{$my_total_num}}）</span>
          </h4>
          <div id="myView"></div>
        </article>
      </main>
    </div>
  </div>
</section>

<script>
// 获取网站地址...
var siteurl="{{:__APP__}}";

// 处理懒加载前的操作...
function doLazyAppear(left, setting) {
  var objCur = $(this);
  // 在当前对象之前创建一个加载等待框...
  objCur.before('<span class="rsPreloader"></span>');
  // 两秒之后，强制删除加载等待框...
  setTimeout(function() {
    objCur.parent().find('.rsPreloader').remove();
  }, 2000);
}
// 处理懒加载后的操作...
function doLazyLoaded(left, setting) {
  $(this).parent().find('.rsPreloader').remove();
}

// 处理 layui 过程...
layui.use(['flow','layer'], function(){
  var max_page = {{$max_page}};
  var flow = layui.flow;
  // 流加载过程，不用弹等待框...
  flow.load({
    elem: '#myView',
    isLazyimg: false,
    done: function(page, next){
      // 设置IE8兼容性，加载分页数据...
      $.ajaxSetup({ cache:false });
      $.ajax({
        type: "get",
        async: true,
        url: siteurl+"/Home/pageRoom/p/"+page,
        success: function(ajaxData) {
          next(ajaxData, page < max_page);
          // 延时加载图片 => 使用外部lazy，不用layui提供的懒加载，不理想...
          // <article>不是标准html标签，必须在外面增加一层<div>...
          // 分页单独懒加载，否则，每次都要全部懒加载...
          // 屏蔽placeholder，使用默认自带的灰色图片...
          $("#page_"+page+" img.lazy").lazyload({
            effect : "fadeIn",
            load: doLazyLoaded,
            appear: doLazyAppear,
            //placeholder: "/wxapi/public/images/snap.png"
          });
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) {
          layer.alert(textStatus+': '+XMLHttpRequest.status+','+errorThrown, {icon: 2});
        }
      });
    }
  });
});
</script>

<include file = "Common:home_footer" />
