<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
  <title>下载录像片段</title>
  <!-- layui css and javascript -->
  <link href="/wxapi/public/layui/css/layui.css" rel="stylesheet" media="all">
  <script src="/wxapi/public/layui/layui.js"></script>  
</head>

<style>
.feed-main {
  top: 0px;
  position: absolute;
}
.feed-table {
  margin: 0px 10px;
  position: relative;
}
.feed-all {
  height: 30px;
  line-height: 30px;
}
.feed-tr {
  height: 40px;
}
.feed-focus {
  background-color: bisque;
}
td a {
  color: dodgerblue;
}
td a:hover {
  color: orangered;
}
</style>

<body>

<div class="feed-main">
  <div class="feed-table">
    <table class="layui-table">
      <colgroup>
        <col width="15%">
        <col width="15%">
        <col width="15%">
        <col width="30%">
        <col width="20%">
      </colgroup>
      <thead>
        <tr>
          <th>片段序号</th>
          <th>片段时长</th>
          <th>片段大小</th>
          <th>录制时间</th>
          <th><button class="layui-btn feed-all" onclick="doDownAll();">全部下载</button></th>
        </tr>
      </thead>
      <tbody id="tRecord">
        <volist name="my_show.list" id="vo">
        <tr class="feed-tr <eq name='my_show.cur_record' value='$vo.record_id'>feed-focus</eq>">
          <td style="text-align:center">{{$vo.slice_inx}}</td>
          <td>{{$vo.disptime}}</td>
          <td>{{$vo['file_size']/1024/1024|number_format=###,2,'.',''}}&nbsp;MB</td>
          <td>{{$vo.created}}</td>
          <td style="text-align:center">
            <a href="{{$my_show.vod_addr}}{{$vo.file_fdfs}}" target='_blank' download="片段_{{$vo.slice_inx}}.mp4">立即下载</a>
          </td>
        </tr>
        </volist>
      </tbody>
    </table>
  </div>
</div>

<script>
// 处理点击全部下载...
function doDownAll() {
  // 获取jquery对象...
  var $ = layui.jquery;
  // 遍历所有的tr记录行...
  $('#tRecord tr').each(function(i){
    $(this).children('td').eq(4).children('a')[0].click();
  });
}
// 处理 layui 过程...
layui.use(['element','layer'], function(){
  // 修改弹框的标题名称...
  var $ = layui.jquery;
  var theLayBox = parent.$('.feed-down-title');
  var theTitle = theLayBox.text() + " - 总共 {{$my_show.total_num}} 个片段";
  // 直接设置父窗口里面的标题名称...
  theLayBox.text(theTitle);
});
</script>

</body>
</html>
